
Component Object Model (COM) -> Permet aux applications codés dans différents langage de charger les mêmes DLL.

Les clés **InProcServer32** ou **LocalServer32** sont situés dans `HKEY_LOCAL_MACHINE\Software\Classes\CLSID\...\` et `HKEY_CURRENT_USER\Software\Classes\CLSID\...`

L'objectif est dans un premier temps d'identifier un COM object :

- Qui ne casse pas pleins de programme lorsqu'il est hijacké.
- Qui n'est pas appelé pleins de fois à la minute ce qui perturberais le système.


## Identifier un COM Object vulnerable

> [!WARNING]
> En general, cette étape est réalisée à partir d'une VM répliquant l'environnent de la victime.
> Le hijacking sera également testé afin de s'assurer de la stabilité du système.

1. Dans Procmon appliquer les filtres suivants  
    - The _Operation_ is **RegOpenKey**.
    - The _Path_ contains InprocServer32 or LocalServer32.
    - The _Result_ is NAME NOT FOUND.

_
![[Pasted image 20250911223321.png]]

Possible d'exporter le resultat de procmon afin d'identifier la fréquence.

2. Une fois le COM object choisi, créer la clé de registre pour le CLSID ainsi que la valeur InprocServer32 contenant le chemain de notre executable / dll ...

```
New-Item -Path "HKCU:Software\Classes\CLSID" -Name "{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5}"
New-Item -Path "HKCU:Software\Classes\CLSID\{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5}" -Name "InprocServer32" -Value "C:\Payloads\http_x64.dll"
New-ItemProperty -Path "HKCU:Software\Classes\CLSID\{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5}\InprocServer32" -Name "ThreadingModel" -Value "Both"
```
