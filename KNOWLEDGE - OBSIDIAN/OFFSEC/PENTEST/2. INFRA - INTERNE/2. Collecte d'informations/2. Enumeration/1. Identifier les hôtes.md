
1. De manière passive (rien n'est envoyé sur le réseau donc indétectable)
	1. [[#1. Table ARP]]
	2. [[#2. Connexions actives]]
	3. [[#3. Recherche DNS inversée]]
	4. [[#4. Capture du trafic]]

2. De manière active en envoyant des requêtes
	1. [[#5. ARP Scan]]
	2. [[#6. ICMP Ping sweep]]
	3. [[#7. Scan NMAP]]

### 1. Table ARP

Identifier le voisinage dans la table ARP de la machine

```cmd
arp -a
```

### 2. Connexions actives

Identifier les connexions actives peut permettre d'identifier d'autres hôtes, et également d'autres sous réseaux.

```cmd
netstat -ano
```

### 3. Recherche DNS inversée

Nmap peut être utilisé avec l'option -sL pour effectuer une recherche DNS inversée sur le réseau (PTR ip > dns). Cela ne génère pas de trafic anormal donc non détecté par les IDS/IPS.

```sh
nmap -sL 192.168.1.0/24 | grep '(' | sed 's/(//; s/)//; 1d; $d' | awk '{print $6, $5}' | tee PTR_records
```

### 4. Capture du trafic

De manière passive en capturant le trafic réseau, filtrer sur le Protocol ARP afin d'identifier les IP, puis MDNS afin d'identifier des noms de machines.

*Wireshark*

```shell
sudo -E wireshark
```

*Tcpdump*

```shell
sudo tcpdump -i eth0 
```

*Netdiscover*

```bash
sudo netdiscover -p -r 192.168.1.0/24 -i eth0
```


*Pktmon*


Analyse supplémentaire avec Responder

```bash
sudo responder -I ens224 -A 
```

```bash
sudo responder -I ens224
```


Laisser tourner un tcpdump sur une journée complète également afin d'identifier des creds potentiels (MiTM).

```shell-session
sudo tcpdump -i ens224 -w capture.pcap
```


---
### 5. ARP Scan

> [!TIP]
> Identifier les hôtes de manière active en envoyant des trames de broadcast ARP.
> 
> Permet également de tester la segmentation du réseau par VLAN (si autre subnet touché, alors pas de VLAN)

Scan basique du réseau

```bash
sudo netdiscover -r 192.168.1.0/24
```

Scan des réseaux répertoriés dans un fichier

```bash
sudo netdiscover -l <file>
```


### 6. ICMP Ping sweep

Identifier les hôtes de manière active avec un ICMP ping sweep

*fping*

https://fping.org/

```shell
fping -asgq 172.16.5.0/23
```

script bash

```bash
for i in {1..254} ;do (ping -c 1 172.16.5.$i | grep "bytes from" &) ;done > hosts_up
```


```bash
cat hosts_up | awk '{print $4}' | tr -d : > hosts.txt
```

script cmd

```cmd
for /L %i in (1 1 254) do ping 172.16.5.%i -n 1 -w 100 | find "Reply"
```

Script Powershell

```powershell
1..254 | % {"172.16.5.$($_): $(Test-Connection -count 1 -comp 172.16.5.$($_) -quiet)"}
```


### 7. Scan NMAP

Scanner les ports ouverts sur les machines identifiées avec NMAP

```bash
sudo nmap -vv -sS -sV -iL hosts.txt -oA host-enum
```

Scanner les ports ouverts sur le réseau complet

```bash
sudo nmap -vv -sS -sV 192.168.110.0/24 -oA host-enum
```
