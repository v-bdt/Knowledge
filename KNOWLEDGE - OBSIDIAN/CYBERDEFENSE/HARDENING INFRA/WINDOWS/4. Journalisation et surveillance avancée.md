
https://blogs.jpcert.or.jp/en/2016/01/windows-commands-abused-by-attackers.html



# Monitorer les changements d'ACEs/ACLs


Activer la [Advanced Security Audit Policy](https://docs.microsoft.com/en-us/archive/blogs/canitpro/step-by-step-enabling-advanced-security-audit-policy-via-ds-access): -> Advanced Audit Policy Configuration -> Audit Policies -> Account Logon ->

Monitorer l'event 5136


Decoder l'attribute value

```powershell-session
ConvertFrom-SddlString "AttributeValue"
```

```powershell-session
ConvertFrom-SddlString "AttributeValue" | select -ExpandProperty DiscretionaryAcl
```



# Monitorer les tentatives de DCSYNC


1. Activer le Directory Service Access auditing.

2. Monitorer l'event 4662.

3. Surveiller les GUID `1131f6aa-9c07-11d1-f79f-00c04fc2dcd2` pour **DS-Replication-Get-Changes** et **DS-Replication-Get-Changes-All**, ou `89e95b76-444d-4c62-991a-0facbeda640c` pour **DS-Replication-Get-Changes-In-Filtered-Set**


# Monitorer les Silver / Golden Ticket

## Silver Ticket

Lors d'un échange de ticket de service légitime, une TGS-REQ est effectuée avant d'obtenir une TGS-REP (associée à l'event 4769).

Etant donné que les tickets sont forgés offline, il faut surveiller les events 4624 (correspondant à l'utilisation d'un ticket de service) qui ne sont pas précédés de l'event 4769.


## Golden Ticket

Lors d'un échange de TGT légitime, une AS-REQ est effectuée avant d'obtenir une AS-REP (associée à l'event 4768).

Etant donné que les tickets sont forgés offline, il faut surveiller les events 4624 (correspondant à l'utilisation d'un ticket de service) qui ne sont pas précédés de l'event 4768.

Surveiller également la durée de vie des tickets, Mimikatz définit la durée de vie à 10 ans par défaut.