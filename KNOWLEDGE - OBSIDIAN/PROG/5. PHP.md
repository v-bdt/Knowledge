
# Fonctions Dangereuses

- **Exécution OS** : `system`, `exec`, `passthru`, `shell_exec`, `popen`.
- **Évaluation PHP** : `eval`, `assert` (ancienne version).
- **Chargement dynamique** : `include`, `require`, `include_once`, `require_once`.
- **Sérialisation** : `unserialize`, `serialize` (check si entrée utilisateur passe dedans).
- **Manipulation fichiers** : `file_put_contents`, `fwrite`, `unlink`, `move_uploaded_file`.
- **Appels dynamiques** : `call_user_func`, `call_user_func_array`.
- **preg_replace** avec le modificateur `e` (<= PHP 5.5, encore présent dans vieux projets).


Exemple de code PHP vulnérable à une désérialisation non sécurisée

```php
<?php


// La classe CustomTemplate est définie avec les propriétés default_desc_type, desc et product
class CustomTemplate {
    private $default_desc_type;
    private $desc;
    public $product;

// Lors de la construction d'un objet de type CustomTemplate, un objet de type Description est crée dans la propriété desc, la propriété default_desc_type prend la valeur HTML_DESC et la fonction build product est appelée afin de construire le produit.
    public function __construct($desc_type='HTML_DESC') {
        $this->desc = new Description();
        $this->default_desc_type = $desc_type;
        $this->build_product();
    }

    public function __sleep() {
        return ["default_desc_type", "desc"];
    }

// La fonction __wakeup est executé lors de la déserialisation de l'objet de type CustomTemplate et execute la fonction build_product.
    public function __wakeup() {
        $this->build_product();
    }

// La fonction build_product construit le produit avec l'objet de type Product et les propriétés default_desc_type et desc.
    private function build_product() {
        $this->product = new Product($this->default_desc_type, $this->desc);
    }
}

// La classe Product est définie avec la propriété desc.
class Product {
    public $desc;

// La fonction construct récupère la propriété default_desc_type de l'objet desc crée précédemment pour la placer dans la propriété desc de la classe Product
    public function __construct($default_desc_type, $desc) {
        $this->desc = $desc->$default_desc_type;
    }
}

class Description {
    public $HTML_DESC;
    public $TEXT_DESC;

    public function __construct() {
        // @Carlos, what were you thinking with these descriptions? Please refactor!
        $this->HTML_DESC = '<p>This product is <blink>SUPER</blink> cool in html</p>';
        $this->TEXT_DESC = 'This product is cool in text';
    }
}

// La classe DefaultMap definie la propriété callback et les functions __construct et __get.
class DefaultMap {
    private $callback;

// La fonction __construct appélée lors de l'instanciation de l'objet récupère la valeur passée dans la propriété callback.
    public function __construct($callback) {
        $this->callback = $callback;
    }

// La fonction __get est appelée lorsque on tente d'accéder à une propriété de la classe DefaultMap qui n'existe pas et call_user_func appel la fonction défini dans callback avec la propriété inexistante placée dans $name. -> RCE possible
    public function __get($name) {
        return call_user_func($this->callback, $name);
    }
}

?>
```








Assert()

```php
?page=salade.php','..') || readfile('.passwd') || strpos('oignons
```